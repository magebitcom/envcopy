---
- name: Create mysql database
  command: "mysql -u{{ mysql_user_local }} -p{{ mysql_pass_local }} -e 'CREATE DATABASE IF NOT EXISTS {{ project | replace('-','_') }};'"

- name: Unarchive database
  shell: "gzip -d /var/www/{{ project }}/sql/web_{{ project }}.sql.gz"

- name: Restore mysql database
  shell: "mysql -u{{ mysql_user_local }} -p{{ mysql_pass_local }} {{ project | replace('-','_') }} < /var/www/{{ project }}/sql/web_{{ project }}.sql"

- name: Replace unsecure web URL
  command: "mysql -u{{ mysql_user_local }} -p{{ mysql_pass_local }} {{ project | replace('-','_') }} -e \"update {{ table_prefix }}core_config_data set value = 'http://{{ project }}.local/' where path = 'web/unsecure/base_url';\""

- name: Replace secure web URL
  command: "mysql -u{{ mysql_user_local }} -p{{ mysql_pass_local }} {{ project | replace('-','_') }} -e \"update {{ table_prefix }}core_config_data set value = 'http://{{ project }}.local/' where path = 'web/secure/base_url';\""

- name: Replace cookie domain
  command: "mysql -u{{ mysql_user_local }} -p{{ mysql_pass_local }} {{ project | replace('-','_') }} -e \"update {{ table_prefix }}core_config_data set value = '{{ project }}.local' where path = 'web/cookie/cookie_domain';\""

- name: Disable sign static
  command: "mysql -u{{ mysql_user_local }} -p{{ mysql_pass_local }} {{ project | replace('-','_') }} -e \"update {{ table_prefix }}core_config_data set value = 0 where path = 'dev/static/sign';\""

- name: Delete MySQL dump
  file:
    path: "/var/www/{{ project }}/sql/web_{{ project }}.sql"
    state: absent
